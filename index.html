<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>录音测试 Github Pages</title>
	<script src="https://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
	<script src="js/recorder.mp3.min.js"></script>
</head>
<style>
	html,body{
		margin:0;
		padding:0;
	}
	body{
		text-align:center;
		padding:10px 50px 0 50px;
		box-sizing:border-box;
		-moz-box-sizing:border-box; /* Firefox */
		-webkit-box-sizing:border-box; /* Safari */
	}
	input[type = "button"] {
		width : 100%;
		height:45px;
		margin-top:15px;
		line-height 45px;
	}
</style>
<body>
	<audio controls autoplay="autoplay" id="audio" src="song.mp3"></audio>
	<!-- controls -->
	<audio controls autoplay="autoplay" id="audio" src=""></audio>
	<input onclick="start()" type="button" value="开始录音" />
	<input onclick="play()" type="button" value="播放录音" />
	
	<input onclick="wxStart()" type="button" value="兼容微信开始录音" />
	<input onclick="play()" type="button" value="兼容微信播放录音" />
</body>

<!-- 可选的独立配置文件，提供此文件时无需修改app.js源码，不然需要修改。注意：使用时应该使用自己编写的文件，而不是使用这个参考用的文件 -->
<script src="js/ios-weixin-config.js"></script>
<!-- 在需要录音功能的页面引入`app-support/app.js`文件（src内的为源码、dist内的为压缩后的）即可 （**注意：需要在https等安全环境下才能进行录音**） -->
<script src="js/app.js"></script>
<script>


function wxStart(){
	RecordApp.RequestPermission(function(){
    RecordApp.Start({},function(){//使用默认配置开始录音，mp3格式
        setTimeout(function(){
            RecordApp.Stop(function(blob,duration){//到达指定条件停止录音
                console.log(URL.createObjectURL(blob),"时长:"+duration+"ms");
                
                //已经拿到blob文件对象想干嘛就干嘛：立即播放、上传
            },function(msg){
                console.log("录音失败:"+msg);
            });
        },3000);
    },function(msg){
        console.log("开始录音失败："+msg);
    });
},function(msg,isUserNotAllow){//用户拒绝未授权或不支持
    console.log((isUserNotAllow?"UserNotAllow，":"")+"无法录音:"+msg);
});


RecordApp.OnProcess=function(pcmData,powerLevel,duration,sampleRate){
    //console.log("PCM实时回调",powerLevel,duration,sampleRate);
};
}


var rec=Recorder();//使用默认配置，mp3格式
var _blob = null;

function start(){
	rec.open(function(){//打开麦克风授权获得相关资源
    rec.start();//开始录音
		setTimeout(function(){
			rec.stop(function(blob,duration){//到达指定条件停止录音
				console.log(URL.createObjectURL(blob),"时长:"+duration+"ms");
				rec.close();//释放录音资源
				//已经拿到blob文件对象想干嘛就干嘛：立即播放、上传
				
				/*立即播放例子*/
				<!-- var audio=document.createElement("audio"); -->
				<!-- audio.controls=true; -->
				<!-- document.body.appendChild(audio); -->
				<!-- //简单的一哔 -->
				<!-- audio.src=URL.createObjectURL(blob); -->
				<!-- audio.play(); -->
				
				_blob = blob;
				
				var audio = document.getElementById('audio');
				audio.src=URL.createObjectURL(blob);
				audio.play();
				
			},function(msg){
				console.log("录音失败:"+msg);
			});
		},3000);
	},function(msg,isUserNotAllow){//用户拒绝未授权或不支持
		console.log((isUserNotAllow?"UserNotAllow，":"")+"无法录音:"+msg);
	});
}

function play(){
	if(_blob){
		var audio = document.getElementById('audio');
		audio.src=URL.createObjectURL(_blob);
		audio.play();
	}else{
		alert("请先点击开始录音");
	}
}

</script>
</html>
