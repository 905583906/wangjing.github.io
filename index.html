<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>录音测试 Github Pages</title>
	<script src="https://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
	<!--script src="js/recorder.mp3.min.js"></script-->
	<script src="js/recorder-core.js"></script> <!--必须引入的录音核心-->
	<script src="js/beta-amr.js"></script> <!--相应格式支持文件-->
	<script src="js/beta-amr-engine.js"></script> <!--如果此格式有额外的编码引擎的话，也要加上-->
</head>
<style>
	html,body{
		margin:0;
		padding:0;
	}
	body{
		text-align:center;
		padding:10px 50px 0 50px;
		box-sizing:border-box;
		-moz-box-sizing:border-box; /* Firefox */
		-webkit-box-sizing:border-box; /* Safari */
	}
	input[type = "button"] {
		width : 100%;
		height:45px;
		margin-top:15px;
		line-height 45px;
	}
</style>
<body>
	<!-- controls -->
	<audio controls autoplay="autoplay" id="audio" src=""></audio>
	<input onclick="start()" type="button" value="开始录音" />
	<input onclick="play()" type="button" value="播放录音" />
	<input onclick="upload()" type="button" value="上传" />
</body>
<script>


var rec=Recorder(
	{
		type:"amr"
	});//使用默认配置，mp3格式
var _blob = null;

function start(){
	rec.open(function(){//打开麦克风授权获得相关资源
    rec.start();//开始录音
		setTimeout(function(){
			rec.stop(function(blob,duration){//到达指定条件停止录音
				console.log(URL.createObjectURL(blob),"时长:"+duration+"ms");
				rec.close();//释放录音资源
				//已经拿到blob文件对象想干嘛就干嘛：立即播放、上传
				
				_blob = blob;
				
				/*立即播放例子*/
				var audio = document.getElementById('audio');
				audio.controls=true;
				audio.src=URL.createObjectURL(blob);
				audio.play();
				
			},function(msg){
				console.log("录音失败:"+msg);
			});
		},3000);
	},function(msg,isUserNotAllow){//用户拒绝未授权或不支持
		console.log((isUserNotAllow?"UserNotAllow，":"")+"无法录音:"+msg);
	});
}

function play(){
	if(_blob){
		var audio = document.getElementById('audio');
		audio.src=URL.createObjectURL(_blob);
		audio.play();
	}else{
		alert("请先点击开始录音");
	}
}

function upload(){
	$.ajax({
	
	})
}

</script>
</html>
